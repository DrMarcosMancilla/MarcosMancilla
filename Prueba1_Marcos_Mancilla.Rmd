---
title: "QTL-SRS"
author: "Marcos Mancilla"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(readxl)
library(graphics)
library(psych)
library(stats)
library(dplyr)
library(tidyr)
library(ggplot2)
library(knitr)
```

# Realizando análisis exploratorio de datos

```{r, warning=FALSE, message=FALSE}
# Este bloque de codigos importa los datos
dat <- read_excel("dataset2.xls")
summary(dat)
head(dat)
str(dat)
```

# Observamos que el set de datos tiene 12.825 observaciones de 12 variables. Existe una variable fecha, 3 variables como texto (Centro, Unidad y Subgrupo) y 8 variables numéricas. Nos se aprecian datos faltantes.

# Graficamos variables de interés (histogramas, boxplots, densidad y densidad acumulada).

# Peces por subgrupo

```{r, warning=FALSE, message=FALSE}
ggplot(dat, aes(x = N_peces)) +
  geom_histogram(bins=30)
```

```{r}
ggplot(dat, aes(x = Subgrupo, y = N_peces, fill=Subgrupo)) +
  geom_boxplot()
```

```{r}
plot(density(dat$N_peces), main="Densidad empírica", xlab="N_peces")
```

```{r}
plot(ecdf(dat$N_peces), main="Distribución acumulada empírica", xlab="N_peces")
```

# Biomasa viva por subgrupo
```{r, warning=FALSE, message=FALSE}
ggplot(dat, aes(x = Biomasa_kg)) +
  geom_histogram(bins = 30)
```

```{r}
ggplot(dat, aes(x=Subgrupo, y = Biomasa_kg, fill=Subgrupo)) +
  geom_boxplot()
```

```{r}
plot(density(dat$Biomasa_kg), main="Densidad empírica", xlab="Biomasa (kg)")
```

```{r}
plot(ecdf(dat$Biomasa_kg), main="Distribución acumulada empírica", xlab="Biomasa_kg")
```

# Mortalidad (n° peces) por subgrupo
```{r, warning=FALSE, message=FALSE}
ggplot(dat, aes(x = Mortalidad)) +
  geom_histogram(bin=30)
```

# Para apreciar mejor como se comporta esta variable, haremos un histograma ajustando el eje x

```{r, warning=FALSE, message=FALSE}
ggplot(dat, aes(x = Mortalidad)) +
  geom_histogram(bin=30)+ scale_x_continuous(limit = c(0,15))
```

```{r, warning=FALSE, message=FALSE}
ggplot(dat, aes(x=Subgrupo, y = Mortalidad, fill=Subgrupo)) +
  geom_boxplot()+ scale_y_continuous(limit = c(0,15))
```

```{r}
plot(density(dat$Mortalidad), main="Densidad empírica", xlab="Mortalidad (n)")
```

```{r}
plot(ecdf(dat$Mortalidad), main="Distribución acumulada empírica", xlab="Mortalidad")
```

# Biomasa de la mortalidad por subgrupo
```{r, warning=FALSE, message=FALSE}
ggplot(dat, aes(x = Mortalidad_Biomasa_kg)) +
  geom_histogram(bins = 30)
```

```{r, warning=FALSE, message=FALSE}
ggplot(dat, aes(x=Subgrupo, y = Mortalidad_Biomasa_kg, fill=Subgrupo)) +
  geom_boxplot()+ scale_y_continuous(limit = c(0,15))
```

```{r}
plot(density(dat$Mortalidad_Biomasa_kg), main="Densidad empírica", xlab="Biomasa Mortalidad (kg)")
```

```{r}
plot(ecdf(dat$Mortalidad), main="Distribución acumulada empírica", xlab="Biomasa Mortalidad (kg)")
```

# Hacemos boxplot de variable respuesta en función de otras variables de interés.
```{r, warning=FALSE, message=FALSE}
ggplot(dat, aes(x=Centro, y = Mortalidad, fill=Subgrupo)) +
  geom_boxplot()+ scale_y_continuous(limit = c(0,15))
```


# Transformaciones de variables a factor

```{r}
dat1 <- dat
table(dat1$Subgrupo)
table(dat1$Centro)
dat1$Centro <- as.factor(dat1$Centro)
dat1$Subgrupo <- as.factor(dat1$Subgrupo)
dat1$Unidad <- as.factor(dat1$Unidad)
str(dat1)
summary(dat1)
```

# Determinar si los datos están balanceados

# Calculamos el número de observaciones por Subgrupo. Luego expresamos la cifra como proporción.
```{r, warning=FALSE, message=FALSE}
table(dat$Subgrupo,dat$Centro)
tabla1 <- with(dat,table(Subgrupo,Centro))
prop.table(tabla1)
tabla1_prop <- with(dat,prop.table(tabla1))
knitr::kable(tabla1_prop,caption ="Proporción datos por Subgrupo de peces en diferentes Centros")
```

# Los datos no están balanceados. Hay más observaciones para el Subgrupo QTL2 (70,7%) que para otros subgrupos. El Subgrupo en menor proporción es el SQTL que está presente solo en Centro C.
