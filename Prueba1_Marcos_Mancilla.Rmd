---
title: "QTL-SRS"
author: "Marcos Mancilla"
date: "16/10/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(graphics)
library(psych)
library(stats)
library(dplyr)
library(tidyr)
library(ggplot2)
```

# Realizando análisis exploratorio de datos
```{r}
dat <- read_excel("dataset2.xls")
summary(dat)
head(dat)
str(dat)
```

Graficando variables

El gráfico representa la distribución de la variable Biomasa (kg) entre Unidades (Jaulas).
```{r}
ggplot(dat, aes(x = Biomasa_kg)) +
  geom_histogram()
```

```{r}
ggplot(dat, aes(x = Biomasa_kg)) +
  geom_boxplot()
```

Para el histograma de la variable "Mortalidad", hacemos un ajuste de escala para apreciar distribución de valores más frecuentes
```{r}
ggplot(dat, aes(x = Mortalidad)) +
  geom_histogram()+ scale_x_continuous(limit = c(0,200))+ scale_y_continuous(limit = c(0,2000))
```

```{r}
ggplot(dat, aes(x = Mortalidad)) +
  geom_boxplot()+ scale_x_continuous(limit = c(0,2000))
```

Para el histograma de la variable Biomasa asociada a mortalidad ("Mortalidad_Biomasa_kg", hacemos un ajuste de escala similar al relizado para la variable Mortalidad.
```{r}
ggplot(dat, aes(x = Mortalidad_Biomasa_kg)) +
  geom_histogram()+ scale_x_continuous(limit = c(0,200))+ scale_y_continuous(limit = c(0,2000))
```

```{r}
ggplot(dat, aes(x = Mortalidad_Biomasa_kg)) +
  geom_boxplot()+ scale_x_continuous(limit = c(0,1800))
```

```{r}
table(dat$Subgrupo)
table(dat$Centro)
dat$Centro <- as.factor(dat$Centro)
dat$Subgrupo <- as.factor(dat$Subgrupo)
str(dat)
summary(dat)
```

```{r}
table(dat$Subgrupo,dat$Centro)
tabla1 <- with(dat,table(Subgrupo,Centro))
prop.table(tabla1)
tabla1_prop <- with(dat,prop.table(tabla1))
knitr::kable(tabla1_prop,caption ="Proporción datos por Subgrupo de peces en diferentes Centros")
```

Los datos no están balanceados. Hay más observaciones para el Subgrupo QTL2 (70,7%) que para otros subgrupos. El Subgrupo en menor proporción es el SQTL que está presente solo en Centro C.
```{r}
df1 <-dat %>%
  select(Subgrupo, Centro, Unidad, Biomasa_kg, N_peces)%>%
  group_by(Subgrupo, Centro, Unidad)%>%
  summarize(Maximo=max(N_peces), Minimo=min(N_peces))
knitr::kable(df1,caption = "N° de peces por unidad (jaula)")
```

El análisis anterior indica que la mayoría de las unidades (jaulas) se cosecharon al final del periodo de observación (Mínimo = 0), quedando solo 9 jaulas con peces. Si sumamos el número de peces por Subgrupo, confirmamos que el Subgrupo QTL2 está sobrerrepresentado. 
```{r}
df2 <-df1 %>%
  select(Subgrupo, Maximo)%>%
  group_by(Subgrupo)%>%
    summarize(Peces=sum(Maximo))
knitr::kable(df2,caption = "N° de peces por Subgrupo")
```

Calculamos ahora la mortalidad asociada a cada subgrupo. 
```{r}
df3 <-dat %>%
  select(Subgrupo, Centro, Unidad, Mortalidad, Mortalidad_Biomasa_kg)%>%
  group_by(Subgrupo, Centro, Unidad)%>%
  summarize(Mortalidad = sum(Mortalidad))%>%
knitr::kable(df3,caption = "Mortalidad de peces por Unidad")
```

```{r}

```

```{r}

```